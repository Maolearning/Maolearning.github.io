<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Êé®ÁÆ±Â≠ê</title>
    <style>
        body { background: #2b2b2b; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; margin: 0; }
        #game-board { display: grid; background: #444; border: 4px solid #666; padding: 10px; border-radius: 8px; }
        .cell { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        .wall { background: #607d8b; border-radius: 4px; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); }
        .floor { background: #34495e; }
        .target { background: #34495e; position: relative; }
        .target::after { content: 'üî¥'; font-size: 15px; opacity: 0.6; }
        .info { margin-bottom: 20px; text-align: center; }
        button { padding: 8px 16px; background: #e67e22; border: none; color: white; border-radius: 4px; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body>
    <div class="info">
        <h2>Á¨¨ <span id="level">1</span> ÂÖ≥</h2>
        <button onclick="resetLevel()">ÈáçÁΩÆÊú¨ÂÖ≥</button>
    </div>
    <div id="game-board"></div>

    <script>
        // 0:Á©∫Âú∞, 1:Â¢ô, 2:ÁÆ±Â≠ê, 3:ÁõÆÊ†áÁÇπ, 4:Áé©ÂÆ∂, 5:ÁÆ±Â≠êÂú®ÁõÆÊ†á‰∏ä, 6:Áé©ÂÆ∂Âú®ÁõÆÊ†á‰∏ä
        const levels = [
            [
                [1,1,1,1,1,0,0,0],
                [1,3,0,0,1,0,0,0],
                [1,0,2,2,1,0,1,1],
                [1,0,0,4,0,2,0,1],
                [1,1,1,0,3,3,0,1],
                [0,0,1,0,0,0,0,1],
                [0,0,1,1,1,1,1,1]
            ],
            [
                [1,1,1,1,1,0,0],
                [1,4,0,0,1,0,0],
                [1,0,2,0,1,0,0],
                [1,0,0,2,0,0,0],
                [1,0,3,3,0,0,1],
                [1,1,1,1,1,1,1]
            ]
        ];

        let currentLevelIdx = 0;
        let map = [];
        let player = {x:0, y:0};
        const board = document.getElementById('game-board');

        function initLevel(idx) {
            currentLevelIdx = idx;
            document.getElementById('level').innerText = idx + 1;
            // Deep copy level
            map = JSON.parse(JSON.stringify(levels[idx % levels.length]));
            draw();
        }

        function draw() {
            board.innerHTML = '';
            board.style.gridTemplateColumns = `repeat(${map[0].length}, 40px)`;
            
            for(let y=0; y<map.length; y++) {
                for(let x=0; x<map[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const val = map[y][x];
                    
                    if(val === 1) cell.classList.add('wall');
                    else if(val === 3 || val === 5 || val === 6) cell.classList.add('target');
                    else cell.classList.add('floor');

                    if(val === 2 || val === 5) cell.innerText = 'üì¶';
                    if(val === 4 || val === 6) {
                        cell.innerText = 'üòÉ';
                        player = {x, y};
                    }
                    board.appendChild(cell);
                }
            }
        }

        function move(dx, dy) {
            const nx = player.x + dx;
            const ny = player.y + dy;
            
            // Ë∂äÁïåÊàñÊíûÂ¢ô
            if(map[ny][nx] === 1) return;

            // ÁßªÂä®ÈÄªËæë
            let isBox = (map[ny][nx] === 2 || map[ny][nx] === 5);
            
            if (isBox) {
                const nnx = nx + dx;
                const nny = ny + dy;
                // ÁÆ±Â≠êÂêéÈù¢ÊòØÂ¢ôÊàñÁÆ±Â≠ê
                if (map[nny][nnx] === 1 || map[nny][nnx] === 2 || map[nny][nnx] === 5) return;
                
                // ÁßªÂä®ÁÆ±Â≠ê
                map[nny][nnx] = (map[nny][nnx] === 3) ? 5 : 2;
                map[ny][nx] = (map[ny][nx] === 5) ? 3 : 0; // ÁÆ±Â≠êÁßªËµ∞ÂêéÔºåÂ¶ÇÊûúÊòØÁõÆÊ†áÁÇπÂàôÂèòÂõû3ÔºåÂê¶Âàô0
            }

            // ÁßªÂä®Áé©ÂÆ∂
            // ÂΩìÂâçÊ†ºÂ≠êÔºöÂ¶ÇÊûúÊòØ6(‰∫∫Âú®ÁõÆÊ†á)ÔºåÁßªËµ∞Âèò3ÔºõÂ¶ÇÊûúÊòØ4ÔºåÁßªËµ∞Âèò0
            map[player.y][player.x] = (map[player.y][player.x] === 6) ? 3 : 0;
            // ÁõÆÊ†áÊ†ºÂ≠êÔºöÂ¶ÇÊûúÊòØ3(ÁõÆÊ†á)ÔºåÂèòÊàê6ÔºõÂ¶ÇÊûúÊòØ0ÔºåÂèòÊàê4
            // Ê≥®ÊÑèÔºöÂõ†‰∏∫‰∏äÈù¢ÂèØËÉΩÂàöÊé®Ëµ∞ÁÆ±Â≠êÔºåË¶ÅÈáçÊñ∞Âà§Êñ≠ÁõÆÊ†áÊ†ºÁä∂ÊÄÅ
            let nextVal = map[ny][nx]; // Ê≠§Êó∂ÂèØËÉΩÊòØ0Êàñ3 (Âõ†‰∏∫ÁÆ±Â≠êÂ∑≤ÁªèÁßªËµ∞‰∫Ü)
            map[ny][nx] = (nextVal === 3) ? 6 : 4;

            draw();
            checkWin();
        }

        function checkWin() {
            // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâÁÆ±Â≠ê(2)ÈÉΩÊ≤°‰∫ÜÔºåÂè™Ââ©‰∏ã(5)
            let win = true;
            for(let row of map) {
                for(let cell of row) {
                    if(cell === 2) win = false;
                }
            }
            if(win) {
                setTimeout(() => {
                    alert("ÊÅ≠ÂñúËøáÂÖ≥ÔºÅËøõÂÖ•‰∏ã‰∏ÄÂÖ≥ üéâ");
                    initLevel(currentLevelIdx + 1);
                }, 100);
            }
        }

        function resetLevel() { initLevel(currentLevelIdx); }

        document.addEventListener('keydown', e => {
            if(e.key === 'ArrowUp' || e.key === 'w') move(0, -1);
            if(e.key === 'ArrowDown' || e.key === 's') move(0, 1);
            if(e.key === 'ArrowLeft' || e.key === 'a') move(-1, 0);
            if(e.key === 'ArrowRight' || e.key === 'd') move(1, 0);
        });

        initLevel(0);
    </script>
</body>
</html>