<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ä¸ƒå·§æ¿</title>
    <style>
        body { background: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        canvas { background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 8px; cursor: move; }
        .tip { margin-top: 15px; color: #555; font-family: sans-serif; }
    </style>
</head>
<body>
    <canvas id="canvas" width="600" height="500"></canvas>
    <div class="tip">ğŸ–±ï¸ æ‹–æ‹½ç§»åŠ¨ï¼ŒğŸ‘† ç‚¹å‡»æ—‹è½¬ 45Â°</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // å®šä¹‰ä¸ƒå·§æ¿çš„åˆå§‹å½¢çŠ¶ (åŸºäºæ ‡å‡†æ¯”ä¾‹)
        // åæ ‡åŸºäº 0,0 åŸç‚¹ï¼Œä¹‹åä¼š translate
        const shapes = [
            { color: '#ff7675', points: [{x:0,y:0}, {x:200,y:0}, {x:100,y:100}] }, // å¤§ä¸‰è§’1
            { color: '#fab1a0', points: [{x:0,y:0}, {x:100,y:100}, {x:0,y:200}] }, // å¤§ä¸‰è§’2
            { color: '#ffeaa7', points: [{x:0,y:0}, {x:100,y:0}, {x:50,y:50}] },   // ä¸­ä¸‰è§’
            { color: '#74b9ff', points: [{x:0,y:0}, {x:50,y:50}, {x:0,y:100}] },   // å°ä¸‰è§’1
            { color: '#0984e3', points: [{x:0,y:0}, {x:100,y:-100}, {x:50,y:-50}] }, // å°ä¸‰è§’2 (éœ€è°ƒæ•´åˆå§‹ç‚¹)
            { color: '#55efc4', points: [{x:0,y:0}, {x:50,y:-50}, {x:100,y:0}, {x:50,y:50}] }, // æ­£æ–¹å½¢
            { color: '#a29bfe', points: [{x:0,y:0}, {x:50,y:50}, {x:50,y:150}, {x:0,y:100}] }  // å¹³è¡Œå››è¾¹å½¢
        ];
        
        // ä¿®æ­£éƒ¨åˆ†åæ ‡ä»¥ä¾¿åˆå§‹æ•£å¼€
        const pieces = [
            { ...shapes[0], x: 100, y: 100, angle: 0 },
            { ...shapes[1], x: 300, y: 100, angle: 0 },
            { ...shapes[2], x: 500, y: 100, angle: 0 },
            { ...shapes[3], x: 100, y: 300, angle: 0 },
            { ...shapes[4], x: 200, y: 300, angle: 0 }, // ä¿®æ­£ç‚¹ä½
            { ...shapes[5], x: 300, y: 300, angle: 0 },
            { ...shapes[6], x: 450, y: 300, angle: 0 }
        ];
        // é‡æ–°å®šä¹‰å½¢çŠ¶5(å°ä¸‰è§’2)å’Œå¹³è¡Œå››è¾¹å½¢é˜²æ­¢åˆå§‹å½¢çŠ¶å´©å
        pieces[4].points = [{x:0,y:0}, {x:100,y:0}, {x:50,y:50}]; // å°ä¸‰è§’2
        pieces[6].points = [{x:0,y:0}, {x:100,y:0}, {x:150,y:50}, {x:50,y:50}]; // å¹³è¡Œå››è¾¹å½¢

        let selectedPiece = null;
        let startX, startY;
        let isDragging = false;

        function drawPiece(p) {
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.angle);
            ctx.fillStyle = p.color;
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(p.points[0].x, p.points[0].y);
            for(let i=1; i<p.points.length; i++) {
                ctx.lineTo(p.points[i].x, p.points[i].y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            ctx.restore();
        }

        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            // ç»˜åˆ¶ç›®æ ‡é˜´å½±ï¼ˆç¤ºä¾‹ï¼šæ­£æ–¹å½¢ï¼‰
            ctx.fillStyle = '#eee';
            ctx.fillRect(200, 150, 200, 200);
            ctx.strokeStyle = '#ddd';
            ctx.strokeRect(200, 150, 200, 200);

            pieces.forEach(p => drawPiece(p));
        }

        // ç®€å•çš„ç‚¹å‡»æ£€æµ‹ (åªæ£€æµ‹åŒ…å›´ç›’ï¼Œä¸ºäº†ä»£ç ç²¾ç®€)
        function hitTest(x, y) {
            // å€’åºæ£€æµ‹ï¼Œä¼˜å…ˆé€‰ä¸­ä¸Šå±‚
            for(let i=pieces.length-1; i>=0; i--) {
                const p = pieces[i];
                // ç®€å•ä¼°ç®—ä¸­å¿ƒè·ç¦»ï¼Œå®é™…åº”åšå¤šè¾¹å½¢æ£€æµ‹
                const dx = x - p.x - 50; // ç²—ç•¥ä¸­å¿ƒä¿®æ­£
                const dy = y - p.y - 50;
                if (Math.sqrt(dx*dx + dy*dy) < 60) {
                    return p;
                }
            }
            return null;
        }

        canvas.addEventListener('mousedown', e => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            selectedPiece = hitTest(mouseX, mouseY);
            if(selectedPiece) {
                startX = mouseX - selectedPiece.x;
                startY = mouseY - selectedPiece.y;
                isDragging = false; // å…ˆå‡è®¾æ˜¯ç‚¹å‡»
                // æåˆ°æœ€ä¸Šå±‚
                pieces.splice(pieces.indexOf(selectedPiece), 1);
                pieces.push(selectedPiece);
                draw();
            }
        });

        canvas.addEventListener('mousemove', e => {
            if(selectedPiece) {
                isDragging = true;
                const rect = canvas.getBoundingClientRect();
                selectedPiece.x = (e.clientX - rect.left) - startX;
                selectedPiece.y = (e.clientY - rect.top) - startY;
                draw();
            }
        });

        canvas.addEventListener('mouseup', e => {
            if(selectedPiece && !isDragging) {
                // å¦‚æœæ²¡æœ‰æ‹–åŠ¨ï¼Œç®—ä½œç‚¹å‡» -> æ—‹è½¬
                selectedPiece.angle += Math.PI / 4; // 45åº¦
                draw();
            }
            selectedPiece = null;
        });

        draw();
    </script>
</body>
</html>